/**
 * @sourav nandan
 * v1.2
 */


function toTimestamp(strDate){
    var datum = Date.parse(strDate);
    return datum/1000;
}

function initC(a, dv, dy, dm, dd) {
    calIdval = a;
    
    if (dv == '') {
        dv = 'basicDay';
    }
    var now = new Date();
    if (dy == '') {
        dy = now.getFullYear();
    }
    if (dm == '') {
        dm = now.getMonth();
    }
    if (dd == '') {
        dd = now.getDate();
    }
    
    loadMediaFiles();
    loadTextDisplays();
    
    // playlists
    $.getJSON("getMediaOnlyPlayList", {
        tags : "tags"
    }, function (a) {
        var b = [""];
        var pTitle;
        filesdata = a;

        $.each(a.playlist, function (a, items) {
            pTitle = items.title +"<br/><p>Duration: "+items.duration+"<br/>Filetype: "+items.filetype+"<br/>Background Playlist: "+(items.playbackground > 0 ? 'Yes' : 'No')+"<br/>Description:<br/>"+items.description+"</p>";
            b.push('<div class="external-event" style="position: relative; z-index: auto; left: 0px; top: 0px;">');
            b.push('<div id="playlistid" class="e_id" style="display:none;">'+items.id+'</div>');
            b.push('<div id="playbackground" style="display:none;">'+items.playbackground+'</div>');
            b.push('<div class="title"><a href="javascript:void(0);" class="tip" title="'+pTitle+'">'+items.title+'</a></div>');
            b.push('</div>');
            b.push('</div>');
        });

        $("#pl-media").append(b.join(""));
        $("#pl-media").css('height','205px');
        $("#pl-media").css('overflow','auto');
		
        $("#pl-media div.external-event").each(function () {
            var a = {
                title: $.trim($(this).find(".title").text()),
                playlistid: $.trim($(this).find("#playlistid").text()),
                playbackground: $.trim($(this).find("#playbackground").text())
            };
        	
            $(this).data("eventObject", a);
            $(this).draggable({
                zIndex: 999,
                revert: true,
                revertDuration: 0,
                helper: 'clone',
                appendTo: 'body'
            });
        });
		
        loadTips();
    });
	
    $.getJSON("getAudioOnlyPlayList", {
        tags : "tags"
    }, function (a) {
        var b = [""];
        var pTitle;
        filesdata = a;

        $.each(a.playlist, function (a, items) {
            pTitle = items.title +"<br/><p>Duration: "+items.duration+"<br/>Filetype: "+items.filetype+"<br/>Background Playlist: "+(items.playbackground > 0 ? 'Yes' : 'No')+"<br/>Description:<br/>"+items.description+"</p>";
            b.push('<div class="external-event" style="position: relative; z-index: auto; left: 0px; top: 0px;">');
            b.push('<div id="playlistid" class="e_id" style="display:none;">'+items.id+'</div>');
            b.push('<div id="playbackground" style="display:none;">'+items.playbackground+'</div>');
            b.push('<div class="title"><a href="javascript:void(0);" class="tip" title="'+pTitle+'">'+items.title+'</a></div>');
            b.push('</div>');
            b.push('</div>');
        });

        $("#pl-audio").append(b.join(""));
        $("#pl-audio").css('height','205px');
        $("#pl-audio").css('overflow','auto');
		
        $("#pl-audio div.external-event").each(function () {
            var a = {
                title: $.trim($(this).find(".title").text()),
                playlistid: $.trim($(this).find("#playlistid").text()),
                playbackground: $.trim($(this).find("#playbackground").text())
            };

            $(this).data("eventObject", a);
            $(this).draggable({
                zIndex: 999,
                revert: true,
                revertDuration: 0,
                helper: 'clone',
                appendTo: 'body'
            });
        });
		
        loadTips();
    });
    
    
 // screen layouts
	
	$.getJSON("getScreenLayoutsOfUser", {
        tags : "tags"
    }, function (a) {
        var b = [""];
        var slTitle;
        filesdata = a;

        $.each(a.files, function (a, items) {
            slTitle = items.screenLayoutTitle;
            b.push("<div class='external-event ui-draggable' style='float:left;position: relative; z-index: auto; left: 0px; top: 0px; width:130px'><div id='screenlayoutid' class='e_f_id' style='display:none;'>" + items.screenLayoutId + "</div><div id='isScreenLayout' style='display:none;'>1</div><div id='title' class='tip' title='"+slTitle+"'>"+items.screenLayoutTitle+"</div></div>");  
        });
    	
        $("#screenlayout_content").append(b.join(""));
        $("#screenlayout_content").css('height','70px');
        $("#screenlayout_content").css('overflow','auto');
    	
        $("#screenlayout_content div.external-event").each(function () {
            
            var a = {
                title: $.trim($(this).find("#title").text()),
                screenlayoutmasterId: $.trim($(this).find("#screenlayoutid").text()),
                isScreenLayout: $.trim($(this).find("#isScreenLayout").text())
            };
        	
            $(this).data("eventObject", a);
            $(this).draggable({
                zIndex: 999,
                revert: true,
                revertDuration: 0,
                helper: 'clone',
                appendTo: 'body'
            });
        		
        });
		
        loadTips();
    });
	
    // text displays
    //loadTextDisplays();
    
 // right col images

var bi = [""];
	
    bi.push('<h4>RSS</h4><div class="external-event ui-draggable" style="position: relative; z-index: auto; left: 0px; top: 0px; width:50px">' +
        '<div id="imgid" class="e_f_id" style="display:none;">1</div>' +
        '<div id="isRssFeed" style="display:none;">1</div>' +
        '<div id="isWeatherFeed" style="display:none;">0</div>' +
        '<div id="title" style="display:none;">RSS</div>' +
        '<div><img src="images/rss_icon.jpg" alt="Loading" /></div>' +
        '</div>');
	
    bi.push('<h4>Weather</h4><div class="external-event ui-draggable" style="position: relative; z-index: auto; left: 0px; top: 0px; width:50px%">' +
        '<div id="imgid" class="e_f_id" style="display:none;">1</div>' +
        '<div id="isRssFeed" style="display:none;">0</div>' +
        '<div id="isWeatherFeed" style="display:none;">1</div>' +
        '<div id="title" style="display:none;">Weather</div>' +
        '<div><img src="images/weather_icon.png" alt="Loading" /></div>' +
        '</div>');
	
    $("#right_col_imgs").append(bi.join(""));
    $("#right_col_imgs").css('height','450px');
    $("#right_col_imgs").css('overflow','auto');
	
    $("#right_col_imgs div.external-event").each(function () {
        var a = {
            title: $.trim($(this).find("#title").text()),
            imgid: $.trim($(this).find("#imgid").text()),
            isRssFeed: $.trim($(this).find("#isRssFeed").text()),
            isWeather: $.trim($(this).find("#isWeatherFeed").text())
        };
		
        $(this).data("eventObject", a);
        $(this).draggable({
            zIndex: 999,
            revert: true,
            revertDuration: 0,
            helper: 'clone',
            appendTo: 'body'
        });
	});
    
    // set width of calendar container relative to screen size
    var sw = $(window).width();
    $('#centerCol').width(sw-600);
    
    var b = null;
    $("#calendar").fullCalendar({
        defaultView: dv,
        year: dy,
        month: dm,
        date: dd,
        theme: true,
        height: 400,
        header: {
            left: "prev,next today,multiDelete",
            center: "title",
            right: "basicDay,todayEvents"
        },
        editable: true,
        droppable: true,
        drop: function (a, b) {
            // retrieve event details and build object
            var data, c;
            data = buildEventDataObject($(this), a);

            c = {
                'start' : toTimestamp(a),
                'end' : toTimestamp(a),
                'title' : data.title,
                'url' : data.url,
                'calId' : $('#calendarId').val(),
                'fileId' : data.fileId,
                'playlistid': data.playlistid,
                'isRssFeed': data.isRssFeed,
                'isWeather': data.isWeather,
                'screenlayoutmasterId': data.screenlayoutmasterId,
                'isScreenLayout': data.isScreenLayout,
                'isDisplayText':data.isDisplayText,
                'displayTextId':data.displayTextId
            };

            $.get("scheduleraddoccurance", c, function(response) {
                // set form values
                $('#calStartDateVal').val(data.start);
                $('#calEndDateVal').val(data.end);
                $('#isWeather').val(data.isWeather);
                $('#isRssFeed').val(data.isRssFeed);
                $('#isPlayList').val(data.isPlayList);
                $('#isPlaybackground').val(data.isPlaybackground);
                $('#isDisplayText').val(data.isDisplayText);
                $('#displayTextId').val(data.displayTextId);
                $('#isScreenLayout').val(data.isScreenLayout);
                $('#fileId').val(data.fileId);
                $('#playlistid').val(data.playlistid);
                $('#screenlayoutmasterId').val(data.screenlayoutmasterId);
                $('#repetdayes').val(data.recurNumberOfDays);
                $('#xlyRepeatFile').val(data.recurFile);
                $('input:radio[name=repeattype]').val([data.repeatType]);
					
                $('#eventtitle').html(data.title);
                $('#eventplaylist').html(data.playlistid);
                $('#eventid').html(response);
                latestEventId = response;
					
                if (data.url != '') {
                    $('#eventimg').attr('src', data.url);
                }
					
                var dsf = $('#calendar').fullCalendar('formatDate', data.start, 'MM/dd/yyyy HH:mm:ss');
                var def = $('#calendar').fullCalendar('formatDate', data.end, 'MM/dd/yyyy HH:mm:ss');
					
                $('#calStartDate').val(dsf);
                $('#calEndDate').val(def);
					
                //display form
                $("#delete").css('display','block');
                $("#boxes #dialog").css('width','425px');
                var d = $("#dialog");
                var e = 100;
                var f = screen.availWidth / 2 - d.width() / 2;
					
                $("#dialog.window").css({
                    left: f,
                    top: e
                }).show().fadeIn();

                window.scrollTo(0,0);
                var g = $(document).height();
                var h = $(window).width();
					
                $("#mask").css({
                    width: h,
                    height: g
                });
					
                $("#mask").fadeIn(1e3);
                $("#mask").fadeTo("slow", .8);
            });
        },
        eventRender: function (a, b) {
            // add data to event
            b.data('isDisplayText', a.isDisplayText);
            b.data('isScreenLayout', a.isScreenLayout);
            b.data('isMedia', a.isMedia);
            b.data('isPlaylist', a.isPlayList);
            b.data('repeatType', a.repeatType);
				
            if (a.isPlayList > 0) {
                b.data('isPlaybackground', a.isPlaybackground);
            } else {
                b.data('isPlaybackground', 0);
            }
				
            // add classes based on type
            var cl = '';
				
            if (a.isDisplayText > 0) {
                cl = 'display-text';
            } else if (a.isScreenLayout > 0) {
                cl = 'screen-layout';
            } else if (a.isPlayList > 0) {
                if (a.isPlaybackground > 0) {
                    cl = 'bg-playlist';
                } else {
                    cl = 'fg-playlist';
                }
            }

            if (cl != '') {
                b.addClass(cl);
            }
        },
        eventDrop: function (a, b, c, d, e) {
            $("#msg").css({
                top: 250
            }).show();
            $.post("schedulerupdateoccurance", {
                start: Math.round(a._start.getTime() / 1e3),
                end: Math.round(a._end.getTime() / 1e3),
                title: a.title,
                id: a._id
            }, function (a) {
                $("#msg").html("Event moved/updated..");
                $("#msg").removeClass("msgattention");
                $("#msg").addClass("msgok")
            })
        },
        eventResize: function (a, b, c, d) {
            $("#msg").css({
                top: 250
            }).show();
            $.post("schedulerupdateoccurance", {
                start: Math.round(a._start.getTime() / 1e3),
                end: Math.round(a._end.getTime() / 1e3),
                title: a.title,
                id: a._id
            }, function (a) {
                $("#msg").html("Event resized/updated..");
                $("#msg").removeClass("msgattention");
                $("#msg").addClass("msgok")
            });
        },
        events: "getdata?calId="+calIdval,
        loading: function (a) {
            if (a) {
                var b = screen.availWidth / 2 - 300;
                $("#loading").css({
                    left: b,
                    top: 250
                }).show()
            } else {
                $("#loading").hide();
            }
        },
        eventMouseover: function(a,b,c){
            var stDate = new Date(a.start);
            var eDate = new Date(a.end);
		
            var d_html='<div class="frm_to_date" style="background:#FFF;padding:5px;border: 1px solid #CCCCCC;color: #000000;font-size: 12px;position: absolute; left: 0pt; top: 15px; z-index: 19; color: rgb(0, 0, 0);">From: '+(stDate.getMonth()+1)+"/"+stDate.getDate()+"/"+stDate.getFullYear()+" "+stDate.getHours()+":"+stDate.getMinutes()+'<br/><br/>To:&nbsp;'+(eDate.getMonth()+1)+"/"+eDate.getDate()+"/"+eDate.getFullYear()+" "+eDate.getHours()+":"+eDate.getMinutes()+'</div>';
        },
        eventMouseout: function(a,b,c){
        //$(this).find('.frm_to_date').remove();
        },
        eventClick: function (a, b, c) {
            if (a.id == 'OTS') {
                return false;
            }
				
            var $target = $(b.target);

            if (!$target.is('input')) {
                b.preventDefault();
                // set form values
                $('#calStartDateVal').val(a.start);
                if (a.end) {
                    $('#calEndDateVal').val(a.end);
                } else {
                    $('#calEndDateVal').val(a.start);
                }
                $('#isWeather').val(a.isWeather);
                $('#isRssFeed').val(a.isRssFeed);
                if (a.isPlayList == 1) {
                    $('#isPlayList').val(1);
					
                    if (a.isPlaybackground == 1) {
                        $('#isPlaybackground').val(1);
                    } else {
                        $('#isPlaybackground').val(0);
                    }
                } else {
                    $('#isPlayList').val(0);
                    $('#isPlaybackground').val(0);
                }
                $('#isScreenLayout').val(a.isScreenLayout);
                $('#displayTextId').val(a.displayTextId);
                $('#isDisplayText').val(a.isDisplayText);
                $('#fileId').val(a.fileId);
                $('#playlistid').val(a.playlistid);
                $('#screenlayoutmasterId').val(a.screenlayoutmasterId);
                $('#repetdayes').val(a.recurNumberOfDays);
                $('#xlyRepeatFile').val(a.recurFile);
                $('input:radio[name=repeattype]').val([a.repeatType || 'dailyRepeatFile']);
					
                $('#eventtitle').html(a.title);
                $('#eventplaylist').html(a.playlistid);
                $('#eventid').html(a.id);
					
                if (a.url != '') {
                    $('#eventimg').attr('src', a.url);
                }
					
                var dsf = $('#calendar').fullCalendar('formatDate', a.start, 'MM/dd/yyyy HH:mm:ss');
				
                if (a.end) {
                    var def = $('#calendar').fullCalendar('formatDate', a.end, 'MM/dd/yyyy HH:mm:ss');
                } else {
                    var def = $('#calendar').fullCalendar('formatDate', a.start, 'MM/dd/yyyy HH:mm:ss');
                }

                $('#calStartDate').val(dsf);
                $('#calEndDate').val(def);
					
                //display form
                $("#delete").css('display','block');
                $("#boxes #dialog").css('width','425px');
                var d = $("#dialog");
                var e = 100;
                var f = screen.availWidth / 2 - d.width() / 2;
				
                $("#dialog.window").css({
                    left: f,
                    top: e
                }).show().fadeIn();

                window.scrollTo(0,0);
                var g = $(document).height();
                var h = $(window).width();
				
                $("#mask").css({
                    width: h,
                    height: g
                });
					
                $("#mask").fadeIn(1e3);
                $("#mask").fadeTo("slow", .8);
            }
        },
        eventAfterRender: function(event, element, view) {
            $(".fc-event").tipTip({
                maxWidth: "210px",
                edgeOffset: 10,
                delay:100,
                fadeIn: 300,
                defaultPosition: "left"
            });;
        },
        viewDisplay: function(view) {
            setTimeout('$(".fc-event").tipTip({maxWidth: "210px", edgeOffset: 10, delay:100, fadeIn: 300, defaultPosition: "left"	});', 500);
        }
    });
    $("#date_picker").datepicker({
        clickInput: true,
        showOn: "button",
        buttonImage: "images/calendar.gif",
        buttonImageOnly: true,
        changeMonth: true,
        changeYear: true,
        onSelect: function (a, b) {
            var c = new Date(a);
            $("#calendar").fullCalendar("gotoDate", c)
        }
    });
    
    $('#searchbtn').click(function(e) {
        $.ajax({
            url: 'createDailyCalendarXmlAjaxCall',
            data: {
                calId: calIdval
            },
            success: function (a) {
                $("#msg").css({
                    top: 250
                }).show();
                $("#msg").html("Calendar created");
                $("#msg").removeClass("msgattention");
                $("#msg").addClass("msgok");
				
                refreshCalendar();
            }
        });
    });
   
    $("#close, #btn-close").click(function (a) {
        // prevent default click action
        a.preventDefault();
        
        closeDetailsWindow();
    });
   
    $(".img_add").live("click",function(){
        // retrieve event details and build object
        var a, b, c, data;
        b = $(this).parent().parent();
        a = $('#calendar').fullCalendar('getDate');
        data = buildEventDataObject(b, a);

        c = {
            'start' : toTimestamp(data.start),
            'end' : toTimestamp(data.end),
            'title' : data.title,
            'url' : data.url,
            'calId' : $('#calendarId').val(),
            'fileId' : data.fileId
        };

        $.get("scheduleraddoccurance", c, function(response) {
            // set form values
            $('#calStartDateVal').val(data.start);
            $('#calEndDateVal').val(data.end);
            $('#isWeather').val(data.isWeather);
            $('#isRssFeed').val(data.isRssFeed);
            $('#isPlayList').val(data.isPlayList);
            $('#isPlaybackground').val(data.isPlaybackground);
            $('#isDisplayText').val(data.isDisplayText);
            $('#displayTextId').val(data.displayTextId);
            $('#isScreenLayout').val(data.isScreenLayout);
            $('#fileId').val(data.fileId);
            $('#playlistid').val(data.playlistid);
            $('#screenlayoutmasterId').val(data.screenlayoutmasterId);
            $('#repetdayes').val(data.recurNumberOfDays);
            $('#xlyRepeatFile').val(data.recurFile);
            $('input:radio[name=repeattype]').val([data.repeatType]);
		
            $('#eventtitle').html(data.title);
            $('#eventplaylist').html(data.playlistid);
            $('#eventid').html(response);
            latestEventId = response;
		
            if (data.url != '') {
                $('#eventimg').attr('src', data.url);
            }
		
            var dsf = $('#calendar').fullCalendar('formatDate', data.start, 'MM/dd/yyyy HH:mm:ss');
            var def = $('#calendar').fullCalendar('formatDate', data.end, 'MM/dd/yyyy HH:mm:ss');
		
            $('#calStartDate').val(dsf);
            $('#calEndDate').val(def);
		
            //display form
            $("#delete").css('display','block');
            $("#boxes #dialog").css('width','425px');
            var d = $("#dialog");
            var e = 100;
            var f = screen.availWidth / 2 - d.width() / 2;
		
            $("#dialog.window").css({
                left: f,
                top: e
            }).show().fadeIn();

            window.scrollTo(0,0);
            var g = $(document).height();
            var h = $(window).width();
		
            $("#mask").css({
                width: h,
                height: g
            });
		
            $("#mask").fadeIn(1e3);
            $("#mask").fadeTo("slow", .8);
        });
    });
    $(".cancel_popup").live("click",function(){
        $("#mask, .window").hide();
        $("#terget").html('');
    });

    $(".add_new_event").live("click",function(){
        if($("#new_s_t").val()!="" && $("#new_e_t").val()!=""){
            $.get("scheduleraddoccurance", {
                start: toTimestamp($("#new_s_t").val()),
                end: toTimestamp($("#new_e_t").val()),
                title: $("#n_a_title").val(),
                id: a._id,
                url: $("#n_a_url").val(),
                calId: $("#n_a_calid").val(),
                fileId:$("#n_a_fileid").val()
            }, function (a) {
                $("#msg").html("Event Added..");
                $("#msg").removeClass("msgattention");
                $("#msg").addClass("msgok")
                location.reload();
            })
        }
    });

    $("#delete").click(function (a) {
        // prevent default click action
        a.preventDefault();
    
        $('#msg1').html('');
        $('#msg1').removeClass("msgok");
        $('#msg1').removeClass("msgattention");
	
        if (!confirm("Delete?")) return;
	
        $.ajax({
            url: 'scheduleDelete',
            data: {
                id: $("#eventid").text()
            },
            success: function (a) {
                $("#msg").css({
                    top: 250
                }).show();
                $("#msg").html("Event deleted");
                $("#msg").removeClass("msgattention");
                $("#msg").addClass("msgok");
            
                refreshCalendar();
            }
        });
    
        // close pop-up
        $("#mask, .window").hide();
    });
    $("#btnnrxt").click(function (a) {
        $("#btnprv").css("display", "block");
        var b = [""];
        $.each(filesdata.files, function (a, c) {
            if (a >= 11 * current && a < 11 * (current + 1)) {
                b.push("<div class='external-event ui-draggable' style='float:left;position: relative; z-index: auto; left: 0px; top: 0px;'><div id='url' style='display:none;'>" + c.thumburl + "</div><div id='fileid' style='display:none;'>" + c.fileid + "</div>");
                b.push("<img class='m_img' src='" + c.thumburl + "' style='float:left' />");
                b.push("<div id='title' style='float:left;width:100px;'><a href='#' class='tip' title='" + c.filename +"<br/><p>Duration: "+c.duration+"<br/>Filetype: "+c.filetype+"<br/>Description:<br/>"+c.description+"</p>'>" + c.filename + "</a></div></div>");
                if (a == nffile) {
                    $("#btnnrxt").css("display", "none")
                }
            } else {};
        });
        $(".external-event").remove();
        $("#external-events").append(b.join(""));
        $("#external-events div.external-event").each(function () {
            var a = {
                title: $.trim($(this).find("#title").text()),
                url: $.trim($(this).find("#url").text()),
                description: $.trim($(this).find("#fileid").text())
            };
            $(this).data("eventObject", a);
            $(this).draggable({
                zIndex: 999,
                revert: true,
                revertDuration: 0,
                helper: 'clone',
                appendTo: 'body'

            })
        });
        current = current + 1

        loadTips();
    });
    $("#btnprv").click(function (a) {
        $("#btnnrxt").css("display", "block");
        current = current - 1;
        var b = [""];
        $.each(filesdata.files, function (a, c) {
            if (a >= 11 * (current - 1) && a < 11 * current) {
                b.push("<div class='external-event ui-draggable' style='float:left;position: relative; z-index: auto; left: 0px; top: 0px;'><div id='url' style='display:none;'>" + c.thumburl + "</div><div id='fileid' style='display:none;'>" + c.fileid + "</div>");
                b.push("<img class='m_img' src='" + c.thumburl + "' style='float:left' />");
                b.push("<div id='title' style='float:left;width:100px;'><a href='#' class='tip' title='" + c.filename +"<br/><p>Duration: "+c.duration+"<br/>Filetype: "+c.filetype+"<br/>Description:<br/>"+c.description+"</p>'>" + c.filename + "</a></div></div>");
                if (a == 0) {
                    $("#btnprv").css("display", "none")
                }
            } else {};
        });
        $(".external-event").remove();
        $("#external-events").append(b.join(""));
        $("#external-events div.external-event").each(function () {
            var a = {
                title: $.trim($(this).find("#title").text()),
                url: $.trim($(this).find("#url").text()),
                description: $.trim($(this).find("#fileid").text())
            };
            $(this).data("eventObject", a);
            $(this).draggable({
                zIndex: 999,
                revert: true,
                revertDuration: 0,
                helper: 'clone',
                appendTo: 'body'
            });
        });

        loadTips();
    });

}

function test(){
    $("#calendar").fullCalendar('removeEvents');
    $('#calendar').fullCalendar('addEventSource', "getdata?calId=" + calIdval);
    $('#calendar').fullCalendar('rerenderEvents');
}
 
function saveTextDisplay() {
	
	var valid = validData('#newdisplaytext'); 
    if(!valid) {
       return;
    }
    
    if ($('#newdisplaytext #transitionEffectId').val() > 0) {
        $.ajax({
            url: "saveNewDisplayText",
            data : {
                displayTextTitle: $('#newdisplaytext #displayTextTitle').val(),
                displayTextDesc: $('#newdisplaytext #displayTextDesc').val(),
                displayTextContent: $('#newdisplaytext #displayTextContent').val(),
                transitionEffectId: $('#newdisplaytext #transitionEffectId').val(),
                displayTextBackGround: $('#newdisplaytext #displayTextBackGround').val(),
                displayTextForeGround: $('#newdisplaytext #displayTextForeGround').val(),
                displayTextBold: $('#newdisplaytext #displayTextBold').val(),
                displayTextItalic: $('#newdisplaytext #displayTextItalic').val(),
                displayTextUnderLine: $('#newdisplaytext #displayTextUnderLine').val()
                
                
            },
            success: function (a) {
                $("#msg2").html("Text display saved");
                $("#msg2").removeClass("msgattention");
                $("#msg2").addClass("msgok");
                $("#msg2").show();
				
                loadTextDisplays();
            }
        });
    } 
    
    closeDialog(1);
}

function updateTextDisplay() {
	
	var valid = validData('#updatedisplaytext'); 
    if(!valid) {
       return;
    }
    
    if ($('#updatedisplaytext #transitionEffectId').val() > 0) {
        $.ajax({
            url: "updateDisplayText",
            data : {
                displayTextId: $('#updatedisplaytext #displayTextId').val(),
                displayTextTitle: $('#updatedisplaytext #displayTextTitle').val(),
                displayTextDesc: $('#updatedisplaytext #displayTextDesc').val(),
                displayTextContent: $('#updatedisplaytext #displayTextContent').val(),
                transitionEffectId: $('#updatedisplaytext #transitionEffectId').val()
            },
            success: function (a) {
                $("#msg3").html("Text display updated");
                $("#msg3").removeClass("msgattention");
                $("#msg3").addClass("msgok");
                $("#msg3").show();
				
                loadTextDisplays();
            }
        });
    } 
    
    closeDialog(2);
}

function deleteTextDisplay(id) {
    if (!confirm('Your calendar entries may also be deleted for this text display. You may have to update the calendar with new entries/events.\n\nAre you sure you wish to delete this text display?')) {
        return false;
    }
	
    $.ajax({
        url: "deleteDisplayTextById",
        data : {
            'displayTextId' : id
        },
        success: function (a) {
            $("#msg").html("Text display removed");
            $("#msg").removeClass("msgattention");
            $("#msg").addClass("msgok");
            $("#msg").show();
			
            loadTextDisplays();
            refreshCalendar();
        }
    });
}

function closeDialog(type) {
    if (type == 1) {
        $('#newdisplaytext').dialog('close');
    } else if (type == 2) {
        $('#updatedisplaytext').dialog('close');
    }
}

function validData(formName) {
	  var isvalid = true;
	  $(formName + ' #displayTextTitleValid').html('');
	  if($(formName + ' #displayTextTitle').val() == '') {
	     $(formName + ' #displayTextTitleValid').html('Required');
	     isvalid = false;
	  }
	  
	  $(formName + ' #displayTextDescValid').html('');
	  if($(formName + ' #displayTextDesc').val() == '') {
	     $(formName + ' #displayTextDescValid').html('Required');
	     isvalid = false;
	  }
	  
	  $(formName + ' #displayTextContentValid').html('');
	  if($(formName + ' #displayTextContent').val() == '') {
	     $(formName + ' #displayTextContentValid').html('Required');
	     isvalid = false;
	  }
	  
	  $(formName + ' #displayTextBackGroundValid').html('');
	  if($(formName + ' #displayTextBackGround').val() == '') {
	     $(formName + ' #displayTextBackGroundValid').html('Required');
	     isvalid = false;
	  }
	   
	  $(formName + ' #displayTextForeGroundValid').html('');
	  if($(formName + ' #displayTextForeGround').val() == '') {
	     $(formName + ' #displayTextForeGroundValid').html('Required');
	     isvalid = false;
	  }
	  
	  return isvalid;
	}
 
function deleteFile(f) {
    if (!confirm('Your calendar entries may also be deleted for this file. You may have to update the calendar with new entries/events.\n\nAre you sure you wish to delete this file?')) {
        return false;
    }

    $.ajax({
        url: "deletefile",
        data : {
            'deletefileId' : f
        },
        success: function (a) {
            $("#msg").html("File removed");
            $("#msg").removeClass("msgattention");
            $("#msg").addClass("msgok");
            $("#msg").show();
			
            loadMediaFiles();
            refreshCalendar();
        }
    });
}
 
function refreshCalendar() {
    $('#calendar').fullCalendar('refetchEvents');
    $('#calendar').fullCalendar('rerenderEvents');
}
 
function loadTips() {
    $(".tip").tipTip({
        maxWidth: "250px",
        edgeOffset: 10,
        delay:100,
        fadeIn: 300,
        defaultPosition: "left"
    });
}
 
function closeDetailsWindow() {
	console.log($('#preventCloseC').val());
    if (toSecondsAfterMidnight(new Date($('#calStartDate').val())) == toSecondsAfterMidnight(new Date($('#calEndDate').val()))) {
        alert('The start and end times for this event are the same.  Please update or delete the event.');
    } else if ($('#preventClose').val() == 1) {
        alert('Please update the start/end time of this event so they do not conflict with other events, or delete this event.');
    } else if ($('#preventCloseC').val() == 1) {
		alert('The start/end times of this have changed. Please click Update before closing.');
    } else {
        $('#msg1').html('');
        $('#msg1').removeClass("msgok");
		
        $("#mask, .window").hide();
		
        refreshCalendar();
    }
}
 
function loadTextDisplays() {
    $('#td_content').html('');
		
    $.getJSON("getdisplaytextlist", {
        tags : "tags"
    }, function (a) {
        var b = [""];
        var tdTitle;
        filesdata = a;

        $.each(a.files, function (a, items) {
            tdTitle = items.title+'<br />Description: '+items.description;
            b.push('<div class="external-event ui-draggable" style="float:left;position: relative; z-index: auto; left: 0px; top: 0px; width:120px;margin-right:6px">');
            b.push('<div id="displayTextId" class="e_f_id" style="display:none;">' + items.id + '</div>');
            b.push('<div id="desc" class="e_f_id" style="display:none;">' + items.description + '</div>');
            b.push('<div id="content" class="e_f_id" style="display:none;">' + items.content + '</div>');
            b.push('<div id="effect" class="e_f_id" style="display:none;">' + items.text_effect_id + '</div>');
            b.push('<div id="isDisplayText" style="display:none;">1</div>');
            b.push('<div id="title" class="tip" title="'+tdTitle+'">'+items.title+'</div>');
            b.push('<a href="javascript:void(0);" class="tip" title="Delete this text display:<br />'+items.title+'" onclick="deleteTextDisplay('+items.id+')"><img width="20" style="position:absolute;right:-6px;bottom:0px;" src="images/delete3.png" /></a>');
            b.push('</div>');
        });
			
        $("#td_content").append(b.join(""));
        $("#td_content").css('height','62px');
        $("#td_content").css('overflow','auto');
	    	
        $("#td_content div.external-event").each(function () {
            var a = {
                title: $.trim($(this).find("#title").text()),
                displayTextId: $.trim($(this).find("#displayTextId").text()),
                isDisplayText: $.trim($(this).find("#isDisplayText").text()),
                desc: $.trim($(this).find("#desc").text()),
                content: $.trim($(this).find("#content").text()),
                effect: $.trim($(this).find("#effect").text())
            };
	        	
            $(this).data("eventObject", a);
            $(this).draggable({
                zIndex: 999,
                revert: true,
                revertDuration: 0,
                helper: 'clone',
                appendTo: 'body'
            });
				
            $(this).click(function(e) {
                var $target = $(e.target);

                if (!($target.is('a') || $target.is('img'))) {
                    // set values
                    $('#updatedisplaytext #displayTextId').val(a.displayTextId);
                    $('#updatedisplaytext #displayTextTitle').val(a.title);
                    $('#updatedisplaytext #displayTextDesc').val(a.desc);
                    $('#updatedisplaytext #displayTextContent').val(a.content);
                    $('#updatedisplaytext #transitionEffectId').val(a.effect);
						
                    // open dialog
                    $('#updatedisplaytext').dialog('open');
                }
            });
        });
			
        loadTips();
    });
}

function loadMediaFiles() {
    $("#external-events").html('');
	
    $.getJSON("getnoaudiofiles", {
        tags: "cat"
    }, function (a) {
        var b = [""];
        var mTitle;
        filesdata = a;	
        $("#btnnrxt").css("display", "none");
        $.each(a.files, function (a, c) {
            mTitle = c.filename +'<br/><p>Duration: '+c.duration+'<br/>Filetype: '+c.filetype+'<br/>Description:<br/>'+c.description;
        	b.push("<div id=" + a + " class='external-event ui-draggable elle' style='float:left;position: relative; z-index: auto; left: 0px; top: 0px;display:none;'><div id='url' style='display:none;' class='e_url'>" + c.thumburl + "</div><div id='fileid' class='e_f_id' style='display:none;'>" + c.fileid + "</div>");
            b.push("<img class='m_img' src='" + c.thumburl + "' style='float:left' />");
        	b.push('<div id="title" style="float:left; width:90px"><a href="#" class="tip" title="'+mTitle+'">' + c.filename + '</a><img class="img_add" src="http://clients.cuion.com/gain/plus.png" /> <a href="javascript:void(0);" class="tip" title="Delete this file:<br />'+c.filename+'" onclick="deleteFile('+c.fileid+')"><img width="20" style="position:absolute;right:-6px;bottom:0px;" src="images/delete3.png" /></a></div></div>');

            nffile = a
        });
        
        $("#nooffiles").html("Files present:" + nffile);
        $("#totalFiles").val(nffile);
        $("#external-events").append(b.join(""));
        $("#external-events").css('width','170px');
        $("#external-events").css('height','420px');
        $("#external-events").css('overflow','auto');
	
        $("#external-events div.external-event").each(function () {
            var a = {
                title: $.trim($(this).find("#title").text()),
                url: $.trim($(this).find("#url").text()),
                description: $.trim($(this).find("#fileid").text())
            };
            
            $(this).data("eventObject", a);
            $(this).draggable({
                zIndex: 999,
                revert: true,
                revertDuration: 0,
                helper: 'clone',
                appendTo: 'body'
            });
        });
        displayFirstRecordsOnly();
        loadTips();
    });
}

function displayFirstRecordsOnly(){
    //alert("inside displayFirstRecordsOnly");
    for(var i=0;i<100;i++){
        $("#"+i).css('display', 'block');
    }
}

function previousPanel() {
    turnPage(-1);
}

function nextPanel() {
    turnPage(1);
}
		
function turnPage(i) {
    // determine if can change page
    var currPage = 0;
    var totalPages = -1;
    var newPage;
	
    $(".mediaPanel").each(function(j, e) {
        if ($(e).is(":visible")) {
            currPage = j;
        }
        totalPages++;
    });
	
    newPage = currPage + i;
	
    if (newPage < 0) {
        newPage = 0;
    } else if (newPage > totalPages) {
        newPage = totalPages;
    }
	
    if (currPage != newPage) {
        $("#ml"+currPage).hide();
        $("#ml"+newPage).show();
    }
	
    // update nav
    if (newPage == 0) {
        hideNavButton("previous");
    } else {
        showNavButton("previous");
    }
	
    if (newPage == totalPages) {
        hideNavButton("next");
    } else {
        showNavButton("next");
    }
}
		
function hideNavButton(type) {
    if (type == "previous") {
        $("#previous").hide();
    } else if (type == "next") {
        $("#next").hide();
    }
}

function showNavButton(type) {
    if (type == "previous") {
        $("#previous").show();
    } else if (type == "next") {
        $("#next").show();
    }
}

function buildEventDataObject(b, a) {
    var d, fid, pid, iid, sid, tid, start, end;
	
    fid = b.find("#fileid").html();
    pid = b.find("#playlistid").html();
    iid = b.find("#imgid").html();
    sid = b.find("#screenlayoutid").html();
    tid = b.find("#displayTextId").html();
	
    //start = ($('#lastEventTime').val() != '') ? new Date($('#lastEventTime').val()) : a;
    if ($('#lastEventTime').val() != '') {
		var f = new Date(), u = toSecondsAfterMidnight(new Date($('#lastEventTime').val())), h, m, s;
		h = Math.floor(u/3600);
		u -= h*3600;
		m = Math.floor(u/60);
		u -= m*60;
		s = u;
		start = new Date(f.getFullYear(), f.getMonth(), f.getDate(), h, m, s);
	} else {
		start = a;
	}
    end = start;
	
    d = {
        'start': start,
        'end': end,
        'calId': calIdval,
        'repeatType': 'dailyRepeatFile',
        'recurFile': '',
        'recurNumberOfDays': '',
        'title': '',
        'url': '',
        'fileId': '',
        'isPlayList': '',
        'isPlaybackground':'',
        'isScreenLayout': '',
        'screenlayoutmasterId': '',
        'playlistid':'',
        'isWeather':'',
        'isRssFeed':'',
        'isDisplayText':'',
        'displayTextId':''
    };

    // files
    if (fid) {
        d.fileId = fid;
        d.title = b.find(".tip").html();
        d.url = b.find(".e_url").html();
    } // playlist
    else if (pid) {
        d.playlistid = pid;
        d.title = b.find(".tip").html();
        d.url = b.find(".e_url").html();
        d.isPlayList = 1;
        d.isPlaybackground = b.find("#playbackground").html();
    } // weather/rss
    else if (iid) {
        d.title = b.find("#title").html();
        d.url = b.find(".e_url").html();
        d.isRssFeed = b.find("#isRssFeed").html();
        d.isWeather = b.find("#isWeatherFeed").html();
    } // screen layout
    else if (sid) {
        d.screenlayoutmasterId = sid;
        d.title = b.find("#title").html();
        d.url = b.find(".e_url").html();
        d.isScreenLayout = b.find("#isScreenLayout").html();
    } // text displays
    else if (tid) {
        d.displayTextId = tid;
        d.isDisplayText = 1;
        d.title = b.find("#title").html();
    }
	
    return d;
}

function renderFreeSlots() {
    var slotStart = 0, slotEnd, evStart, evEnd, evEndP;
    var spec = 300;
	
    $('#calendar .fc-content .fc-event').each(function(i, event) {
        evStart = getEventTime(event, 'start');
        evEnd = getEventTime(event, 'end');
		
        if (evEnd > evEndP || evEndP == undefined) {
            evEndP = evEnd;
        }
		
        if (evStart >= (slotStart+spec)) {
            slotEnd = evStart;
            renderFreeSlot(slotStart, slotEnd);
            slotStart = evEndP;
        } else {
            slotStart = evEndP;
        }
    });

    if ((slotStart+spec) < 86399) {
        renderFreeSlot(slotStart, 86399);
    }
	
    function renderFreeSlot(start, end) {
        var dt = $('#calendar').fullCalendar('getDate');
        var today = dt;
        today.setHours(0,0,0);
		
        var timestamp = Date.parse(today);

        var e = {
            'id': 'OTS',
            'title': '---Open/Free Time Slot---',
            'start': new Date(timestamp+(start*1000)),
            'end': new Date(timestamp+(end*1000)),
            'allDay': false,
            'editable': false,
            'className': 'free-slot'
        };

        $('#calendar').fullCalendar('renderEvent', e, false, true);
    }
}

function getEventTime(ev, w) {
    var span = $(ev).find('.fc-event-time').text();
    var arr = span.split('-');
    var tArr, tStr, mer;
	
    var dt = $('#calendar').fullCalendar('getDate');
	
    if (w == 'end') {
        tStr = $.trim(arr[1]);
    } else {
        tStr = $.trim(arr[0]);
    }
	
    mer = tStr.slice(-2);
    tStr = tStr.substring(0, (tStr.length-3));
    tArr = tStr.split(':');

    if (mer == 'pm' && tArr[0] < 12) {
        tArr[0] = parseInt(tArr[0],10)+12;
    } else if (mer == 'am' && tArr[0] == 12) {
        tArr[0] = 0;
    }
	
    dt.setHours(tArr[0], tArr[1], tArr[2]);

    return toSecondsAfterMidnight(dt);
}

function preventClose() {
	$('#preventCloseC').val(1);
}

var page;
var current = 1;
var filesdata;
var nffile;
var calIdval;
var latestEventId;

/*
 * jQuery UI Slider 1.8.16
 *
 * Copyright 2011, AUTHORS.txt (http://jqueryui.com/about)
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 *
 * http://docs.jquery.com/UI/Slider
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.mouse.js
 *	jquery.ui.widget.js
 */
(function(d){d.widget("ui.slider",d.ui.mouse,{widgetEventPrefix:"slide",options:{animate:false,distance:0,max:100,min:0,orientation:"horizontal",range:false,step:1,value:0,values:null},_create:function(){var a=this,b=this.options,c=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),f=b.values&&b.values.length||1,e=[];this._mouseSliding=this._keySliding=false;this._animateOff=true;this._handleIndex=null;this._detectOrientation();this._mouseInit();this.element.addClass("ui-slider ui-slider-"+
this.orientation+" ui-widget ui-widget-content ui-corner-all"+(b.disabled?" ui-slider-disabled ui-disabled":""));this.range=d([]);if(b.range){if(b.range===true){if(!b.values)b.values=[this._valueMin(),this._valueMin()];if(b.values.length&&b.values.length!==2)b.values=[b.values[0],b.values[0]]}this.range=d("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+(b.range==="min"||b.range==="max"?" ui-slider-range-"+b.range:""))}for(var j=c.length;j<f;j+=1)e.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");
this.handles=c.add(d(e.join("")).appendTo(a.element));this.handle=this.handles.eq(0);this.handles.add(this.range).filter("a").click(function(g){g.preventDefault()}).hover(function(){b.disabled||d(this).addClass("ui-state-hover")},function(){d(this).removeClass("ui-state-hover")}).focus(function(){if(b.disabled)d(this).blur();else{d(".ui-slider .ui-state-focus").removeClass("ui-state-focus");d(this).addClass("ui-state-focus")}}).blur(function(){d(this).removeClass("ui-state-focus")});this.handles.each(function(g){d(this).data("index.ui-slider-handle",
g)});this.handles.keydown(function(g){var k=true,l=d(this).data("index.ui-slider-handle"),i,h,m;if(!a.options.disabled){switch(g.keyCode){case d.ui.keyCode.HOME:case d.ui.keyCode.END:case d.ui.keyCode.PAGE_UP:case d.ui.keyCode.PAGE_DOWN:case d.ui.keyCode.UP:case d.ui.keyCode.RIGHT:case d.ui.keyCode.DOWN:case d.ui.keyCode.LEFT:k=false;if(!a._keySliding){a._keySliding=true;d(this).addClass("ui-state-active");i=a._start(g,l);if(i===false)return}break}m=a.options.step;i=a.options.values&&a.options.values.length?
(h=a.values(l)):(h=a.value());switch(g.keyCode){case d.ui.keyCode.HOME:h=a._valueMin();break;case d.ui.keyCode.END:h=a._valueMax();break;case d.ui.keyCode.PAGE_UP:h=a._trimAlignValue(i+(a._valueMax()-a._valueMin())/5);break;case d.ui.keyCode.PAGE_DOWN:h=a._trimAlignValue(i-(a._valueMax()-a._valueMin())/5);break;case d.ui.keyCode.UP:case d.ui.keyCode.RIGHT:if(i===a._valueMax())return;h=a._trimAlignValue(i+m);break;case d.ui.keyCode.DOWN:case d.ui.keyCode.LEFT:if(i===a._valueMin())return;h=a._trimAlignValue(i-
m);break}a._slide(g,l,h);return k}}).keyup(function(g){var k=d(this).data("index.ui-slider-handle");if(a._keySliding){a._keySliding=false;a._stop(g,k);a._change(g,k);d(this).removeClass("ui-state-active")}});this._refreshValue();this._animateOff=false},destroy:function(){this.handles.remove();this.range.remove();this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider");this._mouseDestroy();
return this},_mouseCapture:function(a){var b=this.options,c,f,e,j,g;if(b.disabled)return false;this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.elementOffset=this.element.offset();c=this._normValueFromMouse({x:a.pageX,y:a.pageY});f=this._valueMax()-this._valueMin()+1;j=this;this.handles.each(function(k){var l=Math.abs(c-j.values(k));if(f>l){f=l;e=d(this);g=k}});if(b.range===true&&this.values(1)===b.min){g+=1;e=d(this.handles[g])}if(this._start(a,g)===false)return false;
this._mouseSliding=true;j._handleIndex=g;e.addClass("ui-state-active").focus();b=e.offset();this._clickOffset=!d(a.target).parents().andSelf().is(".ui-slider-handle")?{left:0,top:0}:{left:a.pageX-b.left-e.width()/2,top:a.pageY-b.top-e.height()/2-(parseInt(e.css("borderTopWidth"),10)||0)-(parseInt(e.css("borderBottomWidth"),10)||0)+(parseInt(e.css("marginTop"),10)||0)};this.handles.hasClass("ui-state-hover")||this._slide(a,g,c);return this._animateOff=true},_mouseStart:function(){return true},_mouseDrag:function(a){var b=
this._normValueFromMouse({x:a.pageX,y:a.pageY});this._slide(a,this._handleIndex,b);return false},_mouseStop:function(a){this.handles.removeClass("ui-state-active");this._mouseSliding=false;this._stop(a,this._handleIndex);this._change(a,this._handleIndex);this._clickOffset=this._handleIndex=null;return this._animateOff=false},_detectOrientation:function(){this.orientation=this.options.orientation==="vertical"?"vertical":"horizontal"},_normValueFromMouse:function(a){var b;if(this.orientation==="horizontal"){b=
this.elementSize.width;a=a.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)}else{b=this.elementSize.height;a=a.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)}b=a/b;if(b>1)b=1;if(b<0)b=0;if(this.orientation==="vertical")b=1-b;a=this._valueMax()-this._valueMin();return this._trimAlignValue(this._valueMin()+b*a)},_start:function(a,b){var c={handle:this.handles[b],value:this.value()};if(this.options.values&&this.options.values.length){c.value=this.values(b);
c.values=this.values()}return this._trigger("start",a,c)},_slide:function(a,b,c){var f;if(this.options.values&&this.options.values.length){f=this.values(b?0:1);if(this.options.values.length===2&&this.options.range===true&&(b===0&&c>f||b===1&&c<f))c=f;if(c!==this.values(b)){f=this.values();f[b]=c;a=this._trigger("slide",a,{handle:this.handles[b],value:c,values:f});this.values(b?0:1);a!==false&&this.values(b,c,true)}}else if(c!==this.value()){a=this._trigger("slide",a,{handle:this.handles[b],value:c});
a!==false&&this.value(c)}},_stop:function(a,b){var c={handle:this.handles[b],value:this.value()};if(this.options.values&&this.options.values.length){c.value=this.values(b);c.values=this.values()}this._trigger("stop",a,c)},_change:function(a,b){if(!this._keySliding&&!this._mouseSliding){var c={handle:this.handles[b],value:this.value()};if(this.options.values&&this.options.values.length){c.value=this.values(b);c.values=this.values()}this._trigger("change",a,c)}},value:function(a){if(arguments.length){this.options.value=
this._trimAlignValue(a);this._refreshValue();this._change(null,0)}else return this._value()},values:function(a,b){var c,f,e;if(arguments.length>1){this.options.values[a]=this._trimAlignValue(b);this._refreshValue();this._change(null,a)}else if(arguments.length)if(d.isArray(arguments[0])){c=this.options.values;f=arguments[0];for(e=0;e<c.length;e+=1){c[e]=this._trimAlignValue(f[e]);this._change(null,e)}this._refreshValue()}else return this.options.values&&this.options.values.length?this._values(a):
this.value();else return this._values()},_setOption:function(a,b){var c,f=0;if(d.isArray(this.options.values))f=this.options.values.length;d.Widget.prototype._setOption.apply(this,arguments);switch(a){case "disabled":if(b){this.handles.filter(".ui-state-focus").blur();this.handles.removeClass("ui-state-hover");this.handles.propAttr("disabled",true);this.element.addClass("ui-disabled")}else{this.handles.propAttr("disabled",false);this.element.removeClass("ui-disabled")}break;case "orientation":this._detectOrientation();
this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation);this._refreshValue();break;case "value":this._animateOff=true;this._refreshValue();this._change(null,0);this._animateOff=false;break;case "values":this._animateOff=true;this._refreshValue();for(c=0;c<f;c+=1)this._change(null,c);this._animateOff=false;break}},_value:function(){var a=this.options.value;return a=this._trimAlignValue(a)},_values:function(a){var b,c;if(arguments.length){b=this.options.values[a];
return b=this._trimAlignValue(b)}else{b=this.options.values.slice();for(c=0;c<b.length;c+=1)b[c]=this._trimAlignValue(b[c]);return b}},_trimAlignValue:function(a){if(a<=this._valueMin())return this._valueMin();if(a>=this._valueMax())return this._valueMax();var b=this.options.step>0?this.options.step:1,c=(a-this._valueMin())%b;a=a-c;if(Math.abs(c)*2>=b)a+=c>0?b:-b;return parseFloat(a.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var a=
this.options.range,b=this.options,c=this,f=!this._animateOff?b.animate:false,e,j={},g,k,l,i;if(this.options.values&&this.options.values.length)this.handles.each(function(h){e=(c.values(h)-c._valueMin())/(c._valueMax()-c._valueMin())*100;j[c.orientation==="horizontal"?"left":"bottom"]=e+"%";d(this).stop(1,1)[f?"animate":"css"](j,b.animate);if(c.options.range===true)if(c.orientation==="horizontal"){if(h===0)c.range.stop(1,1)[f?"animate":"css"]({left:e+"%"},b.animate);if(h===1)c.range[f?"animate":"css"]({width:e-
g+"%"},{queue:false,duration:b.animate})}else{if(h===0)c.range.stop(1,1)[f?"animate":"css"]({bottom:e+"%"},b.animate);if(h===1)c.range[f?"animate":"css"]({height:e-g+"%"},{queue:false,duration:b.animate})}g=e});else{k=this.value();l=this._valueMin();i=this._valueMax();e=i!==l?(k-l)/(i-l)*100:0;j[c.orientation==="horizontal"?"left":"bottom"]=e+"%";this.handle.stop(1,1)[f?"animate":"css"](j,b.animate);if(a==="min"&&this.orientation==="horizontal")this.range.stop(1,1)[f?"animate":"css"]({width:e+"%"},
b.animate);if(a==="max"&&this.orientation==="horizontal")this.range[f?"animate":"css"]({width:100-e+"%"},{queue:false,duration:b.animate});if(a==="min"&&this.orientation==="vertical")this.range.stop(1,1)[f?"animate":"css"]({height:e+"%"},b.animate);if(a==="max"&&this.orientation==="vertical")this.range[f?"animate":"css"]({height:100-e+"%"},{queue:false,duration:b.animate})}}});d.extend(d.ui.slider,{version:"1.8.16"})})(jQuery);
